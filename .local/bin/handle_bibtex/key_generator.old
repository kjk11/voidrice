# This script runs bibtool to generate a new citation key and then  reformats it by invoking the reformat script to avoid empty lines, trailing whitespace and nested brackets

# WORKS

# Things to improve: It does not handle biblatex entries like @InCollection, @Unpublished, @Thesis etc.

# $1 Bibtex entry AS FILE 
# $2 Bibtex entry with new citation key as STANDARD OUTPUT

# Bibtool reformats the key, sed removes empty lines.

bibtool=$(bibtool -f %-n\(author\)_{%-4d\(date\)#%-4d\(year\)#%-4d\(urldate\)#--no-date--}_%-2T\(title\) "$1") 
bash "$SCRIPTS/handle_bibtex/reformat.sh" "$bibtool" 

